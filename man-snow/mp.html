# requirements.txt
flask==2.3.2
pandas==2.0.3
numpy==1.24.3
scikit-learn==1.3.0
xgboost==1.7.6
shap==0.42.1
lime==0.2.0.1
requests==2.31.0
sqlite3
plotly==5.15.0
dash==2.11.1
python-dotenv==1.0.0

# app.py - Main Flask Application
from flask import Flask, render_template, request, jsonify
import pandas as pd
import numpy as np
import pickle
import sqlite3
from datetime import datetime, timedelta
import requests
import json
from models.crop_recommender import CropRecommendationSystem
from models.xai_explainer import XAIExplainer
from utils.weather_api import WeatherAPI
from utils.market_data import MarketDataCollector
from utils.database import DatabaseManager

app = Flask(__name__)

# Initialize system components
crop_system = CropRecommendationSystem()
xai_explainer = XAIExplainer()
weather_api = WeatherAPI()
market_collector = MarketDataCollector()
db_manager = DatabaseManager()

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/dashboard')
def dashboard():
    return render_template('dashboard.html')

@app.route('/api/recommend', methods=['POST'])
def get_recommendations():
    try:
        data = request.get_json()
        
        # Extract environmental data
        soil_data = {
            'nitrogen': data.get('nitrogen'),
            'phosphorus': data.get('phosphorus'),
            'potassium': data.get('potassium'),
            'ph': data.get('ph'),
            'moisture': data.get('moisture')
        }
        
        location = data.get('location')
        
        # Get weather data
        weather_data = weather_api.get_current_weather(location)
        
        # Combine all features
        features = {**soil_data, **weather_data}
        
        # Get ML recommendations
        ml_recommendations = crop_system.predict_crops(features)
        
        # Get market data and re-rank
        market_data = market_collector.get_current_prices()
        final_recommendations = crop_system.rerank_by_market(
            ml_recommendations, market_data
        )
        
        # Generate explanations
        explanations = xai_explainer.explain_recommendations(
            features, final_recommendations
        )
        
        # Get cultivation advice
        advice = crop_system.get_cultivation_advice(
            final_recommendations[0], location
        )
        
        return jsonify({
            'success': True,
            'recommendations': final_recommendations,
            'explanations': explanations,
            'advice': advice,
            'timestamp': datetime.now().isoformat()
        })
        
    except Exception as e:
        return jsonify({'success': False, 'error': str(e)})

@app.route('/api/feedback', methods=['POST'])
def submit_feedback():
    try:
        feedback_data = request.get_json()
        db_manager.store_feedback(feedback_data)
        
        # Trigger model retraining if needed
        if db_manager.get_feedback_count() % 100 == 0:
            crop_system.retrain_model()
            
        return jsonify({'success': True})
    except Exception as e:
        return jsonify({'success': False, 'error': str(e)})

if __name__ == '__main__':
    app.run(debug=True)

# models/crop_recommender.py
import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
import xgboost as xgb
import pickle
import joblib

class CropRecommendationSystem:
    def __init__(self):
        self.model = None
        self.scaler = StandardScaler()
        self.crop_water_requirements = {
            'rice': 1200, 'wheat': 450, 'maize': 500,
            'cotton': 700, 'sugarcane': 1800, 'potato': 400,
            'tomato': 350, 'onion': 300, 'soybean': 450,
            'groundnut': 350
        }
        self.load_model()
    
    def load_model(self):
        try:
            self.model = joblib.load('models/crop_model.pkl')
            self.scaler = joblib.load('models/scaler.pkl')
        except:
            self.train_initial_model()
    
    def train_initial_model(self):
        # Load training data
        df = pd.read_csv('data/crop_recommendation.csv')
        
        # Prepare features and target
        X = df[['N', 'P', 'K', 'temperature', 'humidity', 'ph', 'rainfall']]
        y = df['label']
        
        # Split data
        X_train, X_test, y_train, y_test = train_test_split(
            X, y, test_size=0.2, random_state=42
        )
        
        # Scale features
        X_train_scaled = self.scaler.fit_transform(X_train)
        X_test_scaled = self.scaler.transform(X_test)
        
        # Train ensemble model
        rf_model = RandomForestClassifier(n_estimators=100, random_state=42)
        xgb_model = xgb.XGBClassifier(random_state=42)
        
        rf_model.fit(X_train_scaled, y_train)
        xgb_model.fit(X_train_scaled, y_train)
        
        # Use voting classifier or ensemble
        self.model = rf_model  # Simplified for this example
        
        # Save models
        joblib.dump(self.model, 'models/crop_model.pkl')
        joblib.dump(self.scaler, 'models/scaler.pkl')
    
    def predict_crops(self, features):
        # Convert features to array
        feature_array = np.array([[
            features['nitrogen'], features['phosphorus'], features['potassium'],
            features['temperature'], features['humidity'], features['ph'],
            features['rainfall']
        ]])
        
        # Scale features
        feature_scaled = self.scaler.transform(feature_array)
        
        # Get predictions and probabilities
        predictions = self.model.predict_proba(feature_scaled)[0]
        classes = self.model.classes_
        
        # Create recommendations with suitability scores
        recommendations = []
        for i, prob in enumerate(predictions):
            crop = classes[i]
            water_req = self.crop_water_requirements.get(crop, 500)
            recommendations.append({
                'crop': crop,
                'suitability_score': round(prob, 3),
                'water_requirement': water_req,
                'water_class': self.classify_water_requirement(water_req)
            })
        
        # Sort by suitability
        recommendations.sort(key=lambda x: x['suitability_score'], reverse=True)
        return recommendations[:5]  # Top 5 recommendations
    
    def classify_water_requirement(self, water_req):
        if water_req < 400:
            return 'Low'
        elif water_req < 800:
            return 'Medium'
        else:
            return 'High'
    
    def rerank_by_market(self, recommendations, market_data):
        # Apply economic scoring
        for rec in recommendations:
            crop = rec['crop']
            if crop in market_data:
                price_trend = market_data[crop]['price_trend']
                current_price = market_data[crop]['current_price']
                
                # Calculate economic score
                economic_score = current_price * (1 + price_trend)
                
                # Combine with suitability (weighted average)
                combined_score = (0.7 * rec['suitability_score'] + 
                                0.3 * (economic_score / 1000))
                
                rec['economic_score'] = round(economic_score, 2)
                rec['combined_score'] = round(combined_score, 3)
                rec['projected_margin'] = self.calculate_margin(crop, current_price)
        
        # Re-sort by combined score
        recommendations.sort(key=lambda x: x.get('combined_score', 0), reverse=True)
        return recommendations
    
    def calculate_margin(self, crop, price):
        # Simplified margin calculation
        cost_per_hectare = {
            'rice': 30000, 'wheat': 25000, 'maize': 20000,
            'cotton': 35000, 'sugarcane': 50000
        }
        
        base_cost = cost_per_hectare.get(crop, 25000)
        revenue = price * 1000  # Assuming 1000 kg yield
        margin = revenue - base_cost
        
        return max(0, margin)
    
    def get_cultivation_advice(self, crop_data, location):
        # Generate real-time cultivation advice
        advice = {
            'crop': crop_data['crop'],
            'next_7_days': self.generate_weekly_tasks(crop_data['crop']),
            'irrigation_schedule': self.get_irrigation_schedule(crop_data),
            'weather_alerts': self.get_weather_alerts(location)
        }
        return advice
    
    def generate_weekly_tasks(self, crop):
        # Simplified task generation
        base_tasks = {
            'rice': [
                'Check water levels in field',
                'Monitor for pest activity',
                'Apply nitrogen fertilizer if needed'
            ],
            'wheat': [
                'Monitor soil moisture',
                'Check for rust disease',
                'Plan irrigation schedule'
            ]
        }
        return base_tasks.get(crop, ['Monitor crop health', 'Check soil conditions'])
    
    def get_irrigation_schedule(self, crop_data):
        water_req = crop_data['water_requirement']
        if water_req < 400:
            return 'Irrigate every 7-10 days'
        elif water_req < 800:
            return 'Irrigate every 5-7 days'
        else:
            return 'Irrigate every 3-5 days'
    
    def get_weather_alerts(self, location):
        # This would integrate with weather API
        return ['No severe weather expected in next 7 days']
    
    def retrain_model(self):
        # Implement incremental learning
        print("Retraining model with new feedback data...")
        # This would include feedback data in retraining
        pass

# models/xai_explainer.py
import shap
import lime
from lime.lime_tabular import LimeTabularExplainer
import pandas as pd
import numpy as np

class XAIExplainer:
    def __init__(self):
        self.shap_explainer = None
        self.lime_explainer = None
        self.feature_names = ['nitrogen', 'phosphorus', 'potassium', 
                            'temperature', 'humidity', 'ph', 'rainfall']
    
    def initialize_explainers(self, model, training_data):
        # Initialize SHAP explainer
        self.shap_explainer = shap.TreeExplainer(model)
        
        # Initialize LIME explainer
        self.lime_explainer = LimeTabularExplainer(
            training_data,
            feature_names=self.feature_names,
            mode='classification'
        )
    
    def explain_recommendations(self, features, recommendations):
        explanations = {}
        
        # Convert features to array format
        feature_array = np.array([[
            features['nitrogen'], features['phosphorus'], features['potassium'],
            features['temperature'], features['humidity'], features['ph'],
            features['rainfall']
        ]])
        
        # Generate SHAP explanations
        try:
            if self.shap_explainer:
                shap_values = self.shap_explainer.shap_values(feature_array)
                explanations['shap'] = self.format_shap_explanation(shap_values, features)
        except Exception as e:
            print(f"SHAP explanation error: {e}")
        
        # Generate LIME explanations
        try:
            if self.lime_explainer:
                lime_exp = self.lime_explainer.explain_instance(
                    feature_array[0], 
                    lambda x: np.array([0.5, 0.3, 0.2]),  # Simplified prediction function
                    num_features=len(self.feature_names)
                )
                explanations['lime'] = self.format_lime_explanation(lime_exp)
        except Exception as e:
            print(f"LIME explanation error: {e}")
        
        # Generate farmer-friendly explanations
        explanations['farmer_friendly'] = self.generate_farmer_explanations(
            features, recommendations
        )
        
        return explanations
    
    def format_shap_explanation(self, shap_values, features):
        # Format SHAP values for frontend display
        feature_importance = []
        
        for i, feature_name in enumerate(self.feature_names):
            importance = float(shap_values[0][0][i]) if len(shap_values) > 0 else 0
            feature_importance.append({
                'feature': feature_name,
                'value': features.get(feature_name, 0),
                'importance': importance,
                'impact': 'positive' if importance > 0 else 'negative'
            })
        
        # Sort by absolute importance
        feature_importance.sort(key=lambda x: abs(x['importance']), reverse=True)
        
        return {
            'top_features': feature_importance[:3],
            'all_features': feature_importance
        }
    
    def format_lime_explanation(self, lime_exp):
        # Format LIME explanation
        explanation = lime_exp.as_list()
        
        formatted_exp = []
        for feature_impact in explanation:
            feature_name, impact = feature_impact
            formatted_exp.append({
                'feature': feature_name,
                'impact': impact,
                'direction': 'increases' if impact > 0 else 'decreases'
            })
        
        return formatted_exp
    
    def generate_farmer_explanations(self, features, recommendations):
        # Generate human-readable explanations
        explanations = []
        
        if not recommendations:
            return explanations
        
        top_crop = recommendations[0]['crop']
        
        # Analyze key factors
        if features.get('ph', 7) < 6:
            explanations.append(
                f"Soil pH is acidic ({features['ph']:.1f}), which favors crops like {top_crop}"
            )
        elif features.get('ph', 7) > 8:
            explanations.append(
                f"Soil pH is alkaline ({features['ph']:.1f}), which may limit some crop options"
            )
        
        if features.get('nitrogen', 0) > 80:
            explanations.append(
                f"High nitrogen levels ({features['nitrogen']} ppm) support leafy crops"
            )
        
        if features.get('rainfall', 0) > 200:
            explanations.append(
                f"High rainfall ({features['rainfall']} mm) favors water-loving crops like rice"
            )
        elif features.get('rainfall', 0) < 50:
            explanations.append(
                f"Low rainfall ({features['rainfall']} mm) suggests drought-resistant crops"
            )
        
        if features.get('temperature', 25) > 30:
            explanations.append(
                f"High temperature ({features['temperature']}°C) favors heat-tolerant crops"
            )
        
        return explanations

# utils/weather_api.py
import requests
import json
from datetime import datetime, timedelta

class WeatherAPI:
    def __init__(self):
        self.api_key = "your_weather_api_key"  # Replace with actual API key
        self.base_url = "http://api.openweathermap.org/data/2.5"
    
    def get_current_weather(self, location):
        try:
            # Current weather
            current_url = f"{self.base_url}/weather"
            params = {
                'q': location,
                'appid': self.api_key,
                'units': 'metric'
            }
            
            response = requests.get(current_url, params=params)
            
            if response.status_code == 200:
                data = response.json()
                
                return {
                    'temperature': data['main']['temp'],
                    'humidity': data['main']['humidity'],
                    'rainfall': data.get('rain', {}).get('1h', 0) * 24  # Convert to daily
                }
            else:
                # Return default values if API fails
                return {
                    'temperature': 25,
                    'humidity': 65,
                    'rainfall': 100
                }
        except Exception as e:
            print(f"Weather API error: {e}")
            return {
                'temperature': 25,
                'humidity': 65,
                'rainfall': 100
            }
    
    def get_weather_forecast(self, location, days=7):
        try:
            forecast_url = f"{self.base_url}/forecast"
            params = {
                'q': location,
                'appid': self.api_key,
                'units': 'metric'
            }
            
            response = requests.get(forecast_url, params=params)
            
            if response.status_code == 200:
                data = response.json()
                
                forecast = []
                for item in data['list'][:days * 8]:  # 8 forecasts per day (3-hour intervals)
                    forecast.append({
                        'datetime': item['dt_txt'],
                        'temperature': item['main']['temp'],
                        'humidity': item['main']['humidity'],
                        'rainfall': item.get('rain', {}).get('3h', 0),
                        'description': item['weather'][0]['description']
                    })
                
                return forecast
            
        except Exception as e:
            print(f"Forecast API error: {e}")
            return []

# utils/market_data.py
import requests
import pandas as pd
from datetime import datetime, timedelta
import random

class MarketDataCollector:
    def __init__(self):
        self.base_prices = {
            'rice': 1200, 'wheat': 800, 'maize': 700,
            'cotton': 2500, 'sugarcane': 350, 'potato': 500,
            'tomato': 800, 'onion': 400, 'soybean': 1800,
            'groundnut': 2000
        }
    
    def get_current_prices(self):
        # Simulate real-time price data
        # In production, this would fetch from commodity exchange APIs
        current_prices = {}
        
        for crop, base_price in self.base_prices.items():
            # Simulate price fluctuation
            fluctuation = random.uniform(-0.1, 0.1)  # ±10%
            current_price = base_price * (1 + fluctuation)
            
            # Simulate trend
            trend = random.uniform(-0.05, 0.05)  # ±5% trend
            
            current_prices[crop] = {
                'current_price': round(current_price, 2),
                'base_price': base_price,
                'change_percent': round(fluctuation * 100, 2),
                'price_trend': trend
            }
        
        return current_prices
    
    def get_historical_prices(self, crop, days=90):
        # Generate sample historical data
        dates = pd.date_range(
            start=datetime.now() - timedelta(days=days),
            end=datetime.now(),
            freq='D'
        )
        
        base_price = self.base_prices.get(crop, 1000)
        prices = []
        
        for date in dates:
            # Simulate seasonal variation and random fluctuation
            seasonal_factor = 1 + 0.1 * np.sin(2 * np.pi * date.timetuple().tm_yday / 365)
            random_factor = random.uniform(0.9, 1.1)
            price = base_price * seasonal_factor * random_factor
            
            prices.append({
                'date': date.strftime('%Y-%m-%d'),
                'price': round(price, 2)
            })
        
        return prices
    
    def get_market_news(self):
        # Simulate market news with impact analysis
        sample_news = [
            {
                'headline': 'Monsoon forecast positive for Kharif crops',
                'impact': 'positive',
                'affected_crops': ['rice', 'cotton', 'sugarcane'],
                'impact_score': 0.05,
                'timestamp': datetime.now().isoformat()
            },
            {
                'headline': 'Export restrictions on wheat extended',
                'impact': 'negative',
                'affected_crops': ['wheat'],
                'impact_score': -0.03,
                'timestamp': (datetime.now() - timedelta(hours=2)).isoformat()
            },
            {
                'headline': 'Cotton prices surge on textile demand',
                'impact': 'positive',
                'affected_crops': ['cotton'],
                'impact_score': 0.08,
                'timestamp': (datetime.now() - timedelta(hours=5)).isoformat()
            }
        ]
        
        return sample_news

# utils/database.py
import sqlite3
from datetime import datetime
import json

class DatabaseManager:
    def __init__(self, db_path='crop_system.db'):
        self.db_path = db_path
        self.init_database()
    
    def init_database(self):
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        # Create tables
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS user_feedback (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
                user_id TEXT,
                crop_recommended TEXT,
                feedback_type TEXT,
                feedback_score INTEGER,
                comments TEXT,
                features JSON
            )
        ''')
        
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS recommendations_log (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
                user_id TEXT,
                location TEXT,
                features JSON,
                recommendations JSON,
                explanations JSON
            )
        ''')
        
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS sensor_data (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
                sensor_id TEXT,
                field_id TEXT,
                nitrogen REAL,
                phosphorus REAL,
                potassium REAL,
                ph REAL,
                moisture REAL,
                temperature REAL,
                humidity REAL
            )
        ''')
        
        conn.commit()
        conn.close()
    
    def store_feedback(self, feedback_data):
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute('''
            INSERT INTO user_feedback 
            (user_id, crop_recommended, feedback_type, feedback_score, comments, features)
            VALUES (?, ?, ?, ?, ?, ?)
        ''', (
            feedback_data.get('user_id'),
            feedback_data.get('crop_recommended'),
            feedback_data.get('feedback_type'),
            feedback_data.get('feedback_score'),
            feedback_data.get('comments'),
            json.dumps(feedback_data.get('features', {}))
        ))
        
        conn.commit()
        conn.close()
    
    def get_feedback_count(self):
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute('SELECT COUNT(*) FROM user_feedback')
        count = cursor.fetchone()[0]
        
        conn.close()
        return count
    
    def store_recommendation_log(self, log_data):
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute('''
            INSERT INTO recommendations_log 
            (user_id, location, features, recommendations, explanations)
            VALUES (?, ?, ?, ?, ?)
        ''', (
            log_data.get('user_id'),
            log_data.get('location'),
            json.dumps(log_data.get('features', {})),
            json.dumps(log_data.get('recommendations', [])),
            json.dumps(log_data.get('explanations', {}))
        ))
        
        conn.commit()
        conn.close()
    
    def get_sensor_data(self, field_id, hours=24):
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute('''
            SELECT * FROM sensor_data 
            WHERE field_id = ? AND timestamp >= datetime('now', '-{} hours')
            ORDER BY timestamp DESC
        '''.format(hours), (field_id,))
        
        data = cursor.fetchall()
        conn.close()
        
        return data

# static/js/dashboard.js
class CropDashboard {
    constructor() {
        this.initializeEventListeners();
        this.loadInitialData();
    }
    
    initializeEventListeners() {
        // Recommendation form submission
        document.getElementById('recommendationForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.getRecommendations();
        });
        
        // Feedback buttons
        document.querySelectorAll('.feedback-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.submitFeedback(e.target.dataset.type);
            });
        });
        
        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.switchTab(e.target.dataset.tab);
            });
        });
    }
    
    async getRecommendations() {
        const formData = new FormData(document.getElementById('recommendationForm'));
        const data = Object.fromEntries(formData);
        
        try {
            this.showLoading(true);
            
            const response = await fetch('/api/recommend', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            
            if (result.success) {
                this.displayRecommendations(result.recommendations);
                this.displayExplanations(result.explanations);
                this.displayAdvice(result.advice);
            } else {
                this.showError('Failed to get recommendations: ' + result.error);
            }
        } catch (error) {
            this.showError('Network error: ' + error.message);
        } finally {
            this.showLoading(false);
        }
    }
    
    displayRecommendations(recommendations) {
        const container = document.getElementById('recommendationsContainer');
        
        const html = recommendations.map((rec, index) => `
            <div class="recommendation-card ${index === 0 ? 'top-recommendation' : ''}">
                <div class="crop-header">
                    <h3>${rec.crop.charAt(0).toUpperCase() + rec.crop.slice(1)}</h3>
                    <span class="confidence-badge">Confidence: ${(rec.suitability_score * 100).toFixed(1)}%</span>
                </div>
                
                <div class="crop-metrics">
                    <div class="metric">
                        <span class="metric-label">Water Requirement</span>
                        <span class="metric-value water-${rec.water_class.toLowerCase()}">
                            ${rec.water_class} (${rec.water_requirement}L/ha)
                        </span>
                    </div>
                    
                    ${rec.projected_margin ? `
                    <div class="metric">
                        <span class="metric-label">Projected Margin</span>
                        <span class="metric-value">₹${rec.projected_margin.toLocaleString()}</span>
                    </div>
                    ` : ''}
                    
                    ${rec.economic_score ? `
                    <div class="metric">
                        <span class="metric-label">Market Score</span>
                        <span class="metric-value">${rec.economic_score.toFixed(2)}</span>
                    </div>
                    ` : ''}
                </div>
                
                <div class="crop-actions">
                    <button class="btn-primary explain-btn" data-crop="${rec.crop}">
                        Why ${rec.crop}?
                    </button>
                    <button class="btn-secondary tasks-btn" data-crop="${rec.crop}">
                        See Tasks
                    </button>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = html;
        
        // Add event listeners for explanation buttons
        container.querySelectorAll('.explain-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.showExplanation(e.target.dataset.crop);
            });
        });
    }
    
    displayExplanations(explanations) {
        // Display SHAP explanations
        if (explanations.shap) {
            this.renderShapChart(explanations.shap);
        }
        
        // Display farmer-friendly explanations
        if (explanations.farmer_friendly && explanations.farmer_friendly.length > 0) {
            const container = document.getElementById('explanationText');
            const html = explanations.farmer_friendly.map(exp => 
                `<div class="explanation-item">
                    <i class="icon-info"></i>
                    <span>${exp}</span>
                </div>`
            ).join('');
            
            container.innerHTML = html;
        }
    }
    
    renderShapChart(shapData) {
        const container = document.getElementById('shapChart');
        
        if (!shapData.top_features || shapData.top_features.length === 0) {
            container.innerHTML = '<p>No explanation data available</p>';
            return;
        }
        
        const features = shapData.top_features;
        const html = features.map(feature => `
            <div class="shap-feature">
                <div class="feature-info">
                    <span class="feature-name">${feature.feature.replace('_', ' ').toUpperCase()}</span>
                    <span class="feature-value">${feature.value}</span>
                </div>
                <div class="importance-bar">
                    <div class="bar ${feature.impact}" 
                         style="width: ${Math.abs(feature.importance) * 100}%">
                    </div>
                </div>
                <span class="importance-value ${feature.impact}">
                    ${feature.importance > 0 ? '+' : ''}${feature.importance.toFixed(3)}
                </span>
            </div>
        `).join('');
        
        container.innerHTML = `
            <h4>Key Factors Influencing Recommendation</h4>
            <div class="shap-features">
                ${html}
            </div>
        `;
    }
    
    displayAdvice(advice) {
        if (!advice) return;
        
        // Display weekly tasks
        if (advice.next_7_days) {
            const tasksContainer = document.getElementById('weeklyTasks');
            const tasksHtml = advice.next_7_days.map((task, index) => `
                <div class="task-item">
                    <div class="task-day">Day ${index + 1}</div>
                    <div class="task-description">${task}</div>
                </div>
            `).join('');
            
            tasksContainer.innerHTML = tasksHtml;
        }
        
        // Display irrigation schedule
        if (advice.irrigation_schedule) {
            document.getElementById('irrigationAdvice').textContent = advice.irrigation_schedule;
        }
        
        // Display weather alerts
        if (advice.weather_alerts && advice.weather_alerts.length > 0) {
            const alertsContainer = document.getElementById('weatherAlerts');
            const alertsHtml = advice.weather_alerts.map(alert => `
                <div class="weather-alert">
                    <i class="icon-warning"></i>
                    <span>${alert}</span>
                </div>
            `).join('');
            
            alertsContainer.innerHTML = alertsHtml;
        }
    }
    
    async submitFeedback(feedbackType) {
        const currentRecommendation = document.querySelector('.top-recommendation h3').textContent.toLowerCase();
        
        try {
            const response = await fetch('/api/feedback', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    feedback_type: feedbackType,
                    crop_recommended: currentRecommendation,
                    timestamp: new Date().toISOString()
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                this.showSuccess('Feedback submitted successfully!');
            } else {
                this.showError('Failed to submit feedback');
            }
        } catch (error) {
            this.showError('Network error: ' + error.message);
        }
    }
    
    switchTab(tabName) {
        // Remove active class from all tabs and content
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        
        // Add active class to selected tab and content
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        document.getElementById(`${tabName}Tab`).classList.add('active');
        
        // Load tab-specific data
        if (tabName === 'markets') {
            this.loadMarketData();
        } else if (tabName === 'fields') {
            this.loadFieldData();
        }
    }
    
    async loadMarketData() {
        // Load and display market data
        // This would fetch current prices and news
        console.log('Loading market data...');
    }
    
    async loadFieldData() {
        // Load and display field sensor data
        console.log('Loading field data...');
    }
    
    loadInitialData() {
        // Load any initial dashboard data
        this.updateTimestamp();
        
        // Update timestamp every minute
        setInterval(() => {
            this.updateTimestamp();
        }, 60000);
    }
    
    updateTimestamp() {
        const timestampElement = document.getElementById('lastUpdate');
        if (timestampElement) {
            timestampElement.textContent = new Date().toLocaleString();
        }
    }
    
    showLoading(show) {
        const loader = document.getElementById('loadingIndicator');
        if (loader) {
            loader.style.display = show ? 'block' : 'none';
        }
    }
    
    showError(message) {
        this.showNotification(message, 'error');
    }
    
    showSuccess(message) {
        this.showNotification(message, 'success');
    }
    
    showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 5000);
    }
}

// Initialize dashboard when page loads
document.addEventListener('DOMContentLoaded', () => {
    new CropDashboard();
});

# templates/index.html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CropWise - Transparent Real-time Crop Intelligence</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1>CropWise</h1>
            </div>
            <div class="nav-menu">
                <a href="#product">Product</a>
                <a href="#markets">Markets</a>
                <a href="#pricing">Pricing</a>
                <a href="/dashboard" class="btn-primary">Dashboard</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-container">
            <div class="hero-content">
                <h1 class="hero-title">Transparent, real-time crop intelligence</h1>
                <p class="hero-subtitle">
                    Fuses soil, weather, and markets to rank crops by water and profit—with reasons farmers can trust
                </p>
                
                <div class="hero-actions">
                    <a href="/dashboard" class="btn-primary btn-large">Try with farm data</a>
                    <a href="#demo" class="btn-secondary btn-large">See live demo</a>
                </div>
            </div>
            
            <div class="hero-widgets">
                <!-- Live micro-widgets -->
                <div class="widget-grid">
                    <div class="micro-widget">
                        <div class="widget-header">
                            <i class="icon-moisture"></i>
                            <span>Soil Moisture</span>
                        </div>
                        <div class="widget-value" id="moistureValue">24%</div>
                        <div class="widget-trend positive">+2% from yesterday</div>
                    </div>
                    
                    <div class="micro-widget">
                        <div class="widget-header">
                            <i class="icon-rain"></i>
                            <span>7-day Rain Probability</span>
                        </div>
                        <div class="widget-value" id="rainProbability">68%</div>
                        <div class="widget-trend neutral">Moderate chance</div>
                    </div>
                    
                    <div class="micro-widget recommendation-chip">
                        <div class="widget-header">
                            <i class="icon-crop"></i>
                            <span>Top crop today</span>
                        </div>
                        <div class="widget-value" id="topCrop">Wheat</div>
                        <button class="see-why-btn">See why?</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Grid -->
    <section class="features" id="product">
        <div class="container">
            <h2 class="section-title">Powered by transparent AI</h2>
            
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="icon-brain"></i>
                    </div>
                    <h3>Explainable recommendations</h3>
                    <p>SHAP and LIME algorithms reveal exactly why each crop was recommended, with plain-language explanations farmers can understand.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="icon-water"></i>
                    </div>
                    <h3>Water-aware ranking</h3>
                    <p>Crops ranked by water requirements and sowing windows, helping optimize irrigation and resource planning.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="icon-market"></i>
                    </div>
                    <h3>Market price re-ranking</h3>
                    <p>Real-time market data re-ranks agronomic recommendations to maximize projected profit margins.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="icon-tasks"></i>
                    </div>
                    <h3>Adaptive tasks</h3>
                    <p>Weather-responsive daily guidance adjusts irrigation, fertilization, and pest management to current conditions.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="icon-news"></i>
                    </div>
                    <h3>Market news impact</h3>
                    <p>AI analyzes agricultural news and policy changes, showing how they affect crop rankings and profitability.</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="icon-feedback"></i>
                    </div>
                    <h3>Feedback loop</h3>
                    <p>One-tap feedback continuously improves model accuracy and explanation quality through farmer input.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Trust Section -->
    <section class="trust">
        <div class="container">
            <div class="trust-stats">
                <div class="stat-card">
                    <div class="stat-number">97%+</div>
                    <div class="stat-label">Model accuracy reported</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-number">24/7</div>
                    <div class="stat-label">Real-time monitoring</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-number">15+</div>
                    <div class="stat-label">Data sources integrated</div>
                </div>
            </div>
            
            <div class="case-studies">
                <h3>Proven Results</h3>
                <div class="case-study-grid">
                    <div class="case-study-card">
                        <div class="case-metric">+34% margin</div>
                        <p>Maharashtra cotton farmer increased profit margin using market-aware crop switching recommendations.</p>
                    </div>
                    
                    <div class="case-study-card">
                        <div class="case-metric">-28% water</div>
                        <p>Punjab wheat cooperative reduced irrigation needs through optimized variety selection and timing.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Demo Section -->
    <section class="demo" id="demo">
        <div class="container">
            <h2 class="section-title">See it in action</h2>
            
            <div class="demo-interface">
                <div class="demo-sidebar">
                    <h4>Sample Field Data</h4>
                    <div class="demo-inputs">
                        <div class="input-group">
                            <label>Soil NPK</label>
                            <span class="demo-value">N:80 P:45 K:60</span>
                        </div>
                        <div class="input-group">
                            <label>pH Level</label>
                            <span class="demo-value">6.8</span>
                        </div>
                        <div class="input-group">
                            <label>Moisture</label>
                            <span class="demo-value">24%</span>
                        </div>
                        <div class="input-group">
                            <label>Temperature</label>
                            <span class="demo-value">28°C</span>
                        </div>
                    </div>
                    
                    <button class="btn-primary demo-run">Run Analysis</button>
                </div>
                
                <div class="demo-results">
                    <div class="demo-recommendations">
                        <h4>Top Recommendations</h4>
                        <div class="demo-crop-list">
                            <div class="demo-crop-item active">
                                <span class="crop-name">Wheat</span>
                                <span class="suitability">92%</span>
                                <span class="water-class low">Low water</span>
                                <span class="margin">₹45,000 margin</span>
                            </div>
                            <div class="demo-crop-item">
                                <span class="crop-name">Mustard</span>
                                <span class="suitability">87%</span>
                                <span class="water-class low">Low water</span>
                                <span class="margin">₹38,000 margin</span>
                            </div>
                            <div class="demo-crop-item">
                                <span class="crop-name">Chickpea</span>
                                <span class="suitability">83%</span>
                                <span class="water-class medium">Med water</span>
                                <span class="margin">₹41,000 margin</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="demo-explanation">
                        <h4>Why Wheat? <i class="icon-explain"></i></h4>
                        <div class="explanation-factors">
                            <div class="factor positive">
                                <span class="factor-name">Cool season timing</span>
                                <span class="factor-impact">+0.15</span>
                            </div>
                            <div class="factor positive">
                                <span class="factor-name">Optimal pH range</span>
                                <span class="factor-impact">+0.08</span>
                            </div>
                            <div class="factor positive">
                                <span class="factor-name">Current market premium</span>
                                <span class="factor-impact">+0.12</span>
                            </div>
                        </div>
                        
                        <div class="farmer-insight">
                            <i class="icon-lightbulb"></i>
                            <span>"Cool winter weather and current soil conditions strongly favor wheat. Market prices are 15% above average due to export demand."</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta">
        <div class="container">
            <div class="cta-content">
                <h2>Ready to optimize your crop decisions?</h2>
                <p>Join farmers already using transparent AI to increase profits and reduce water usage.</p>
                
                <div class="cta-actions">
                    <a href="/dashboard" class="btn-primary btn-large">Start with your data</a>
                    <a href="#contact" class="btn-outline btn-large">Talk to agronomist</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>CropWise</h4>
                    <p>Transparent crop intelligence for sustainable farming.</p>
                </div>
                
                <div class="footer-section">
                    <h5>Features</h5>
                    <ul>
                        <li>Real-time recommendations</li>
                        <li>Market integration</li>
                        <li>Water optimization</li>
                        <li>Explainable AI</li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h5>Support</h5>
                    <ul>
                        <li>Offline capability</li>
                        <li>Multi-language support</li>
                        <li>SMS alerts</li>
                        <li>24/7 monitoring</li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h5>Data</h5>
                    <ul>
                        <li>IoT sensors</li>
                        <li>Weather APIs</li>
                        <li>Market feeds</li>
                        <li>Privacy protection</li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 CropWise. Empowering farmers with transparent AI.</p>
                <div class="footer-links">
                    <a href="#privacy">Privacy</a>
                    <a href="#terms">Terms</a>
                    <a href="#data">Data Sources</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>

# templates/dashboard.html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CropWise Dashboard - Real-time Crop Intelligence</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-left">
            <h1 class="dashboard-title">CropWise Dashboard</h1>
            <select class="field-selector">
                <option value="field1">North Field (12.5 ha)</option>
                <option value="field2">South Field (8.3 ha)</option>
                <option value="field3">East Field (15.2 ha)</option>
            </select>
        </div>
        
        <div class="nav-right">
            <div class="update-status">
                <span class="update-indicator online"></span>
                <span>Last update: <span id="lastUpdate">--</span></span>
            </div>
            <select class="language-selector">
                <option value="en">English</option>
                <option value="hi">हिंदी</option>
                <option value="te">తెలుగు</option>
            </select>
            <div class="profile-menu">
                <img src="/static/images/profile.png" alt="Profile" class="profile-pic">
            </div>
        </div>
    </nav>

    <!-- Main Dashboard -->
    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="nav-items">
                <a href="#overview" class="nav-item active" data-tab="overview">
                    <i class="icon-dashboard"></i>
                    <span>Overview</span>
                </a>
                <a href="#crop-brain" class="nav-item" data-tab="crop-brain">
                    <i class="icon-brain"></i>
                    <span>Crop Brain</span>
                </a>
                <a href="#markets" class="nav-item" data-tab="markets">
                    <i class="icon-chart"></i>
                    <span>Markets</span>
                </a>
                <a href="#fields" class="nav-item" data-tab="fields">
                    <i class="icon-field"></i>
                    <span>Fields & Sensors</span>
                </a>
                <a href="#guidance" class="nav-item" data-tab="guidance">
                    <i class="icon-tasks"></i>
                    <span>Guidance</span>
                </a>
                <a href="#feedback" class="nav-item" data-tab="feedback">
                    <i class="icon-feedback"></i>
                    <span>Feedback</span>
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                <div class="spinner"></div>
                <span>Analyzing your data...</span>
            </div>

            <!-- Overview Tab -->
            <div id="overviewTab" class="tab-content active">
                <div class="tab-header">
                    <h2>Field Overview</h2>
                    <div class="quick-actions">
                        <button class="btn-primary">Get Recommendations</button>
                        <button class="btn-outline">View Report</button>
                    </div>
                </div>

                <!-- Input Form -->
                <form id="recommendationForm" class="input-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="nitrogen">Nitrogen (ppm)</label>
                            <input type="number" id="nitrogen" name="nitrogen" value="80" required>
                        </div>
                        <div class="form-group">
                            <label for="phosphorus">Phosphorus (ppm)</label>
                            <input type="number" id="phosphorus" name="phosphorus" value="45" required>
                        </div>
                        <div class="form-group">
                            <label for="potassium">Potassium (ppm)</label>
                            <input type="number" id="potassium" name="potassium" value="60" required>
                        </div>
                        <div class="form-group">
                            <label for="ph">pH Level</label>
                            <input type="number" id="ph" name="ph" step="0.1" value="6.8" required>
                        </div>
                        <div class="form-group">
                            <label for="moisture">Soil Moisture (%)</label>
                            <input type="number" id="moisture" name="moisture" value="24" required>
                        </div>
                        <div class="form-group">
                            <label for="location">Location</label>
                            <input type="text" id="location" name="location" value="Delhi, India" required>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-primary btn-large">
                        <i class="icon-analyze"></i>
                        Analyze & Recommend
                    </button>
                </form>

                <!-- Recommendation Snapshot -->
                <div class="snapshot-grid">
                    <div class="snapshot-card recommendations-snapshot">
                        <h3>Top Recommendations</h3>
                        <div id="recommendationsContainer">
                            <div class="empty-state">
                                <i class="icon-crop"></i>
                                <p>Submit field data to get personalized crop recommendations</p>
                            </div>
                        </div>
                    </div>

                    <div class="snapshot-card weather-snapshot">
                        <h3>Weather & Irrigation</h3>
                        <div class="weather-content">
                            <div class="weather-current">
                                <div class="weather-temp">28°C</div>
                                <div class="weather-desc">Partly cloudy</div>
                            </div>
                            <div class="weather-forecast">
                                <div class="forecast-item">
                                    <span class="day">Tomorrow</span>
                                    <span class="rain-chance">65% rain</span>
                                </div>
                                <div class="forecast-item">
                                    <span class="day">Day 2</span>
                                    <span class="rain-chance">30% rain</span>
                                </div>
                            </div>
                            <div id="irrigationAdvice" class="irrigation-advice">
                                Irrigation window: 8-10 AM tomorrow
                            </div>
                        </div>
                    </div>

                    <div class="snapshot-card market-snapshot">
                        <h3>Market Pulse</h3>
                        <div class="market-tickers">
                            <div class="ticker-item">
                                <span class="crop-name">Wheat</span>
                                <span class="price">₹1,850</span>
                                <span class="change positive">+3.2%</span>
                            </div>
                            <div class="ticker-item">
                                <span class="crop-name">Rice</span>
                                <span class="price">₹1,200</span>
                                <span class="change negative">-1.8%</span>
                            </div>
                            <div class="ticker-item">
                                <span class="crop-name">Cotton</span>
                                <span class="price">₹5,500</span>
                                <span class="change positive">+5.1%</span>
                            </div>
                        </div>
                        <div class="market-alerts" id="weatherAlerts">
                            <div class="alert-item">
                                <i class="icon-info"></i>
                                <span>Export demand driving wheat prices up</span>
                            </div>
                        </div>
                    </div>

                    <div class="snapshot-card data-health">
                        <h3>Data Health</h3>
                        <div class="health-indicators">
                            <div class="health-item">
                                <div class="health-label">Soil Sensors</div>
                                <div class="health-status online">Online</div>
                            </div>
                            <div class="health-item">
                                <div class="health-label">Weather Feed</div>
                                <div class="health-status online">Active</div>
                            </div>
                            <div class="health-item">
                                <div class="health-label">Market Data</div>
                                <div class="health-status online">Live</div>
                            </div>
                            <div class="health-item">
                                <div class="health-label">Last Calibration</div>
                                <div class="health-value">2 days ago</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Crop Brain Tab -->
            <div id="crop-brainTab" class="tab-content">
                <div class="tab-header">
                    <h2>Crop Brain</h2>
                    <div class="brain-controls">
                        <div class="weight-toggle">
                            <label>Agronomy</label>
                            <input type="range" id="agronomyWeight" min="0" max="100" value="70">
                            <label>Market</label>
                        </div>
                    </div>
                </div>

                <!-- Brain Tabs -->
                <div class="brain-tabs">
                    <button class="tab-btn active" data-tab="recommend">Recommend</button>
                    <button class="tab-btn" data-tab="explain">Explain</button>
                    <button class="tab-btn" data-tab="profit">Profit</button>
                </div>

                <!-- Recommend Content -->
                <div id="recommendContent" class="brain-content active">
                    <div class="recommendations-detailed" id="detailedRecommendations">
                        <!-- Detailed recommendations will be populated here -->
                    </div>
                </div>

                <!-- Explain Content -->
                <div id="explainContent" class="brain-content">
                    <div class="explanation-container">
                        <div class="shap-section">
                            <div id="shapChart" class="chart-container">
                                <p>Submit field data to see explanations</p>
                            </div>
                        </div>
                        
                        <div class="farmer-explanations">
                            <h4>Plain Language Insights</h4>
                            <div id="explanationText" class="explanation-text">
                                <div class="empty-state">
                                    <i class="icon-lightbulb"></i>
                                    <p>Explanations will appear here after analysis</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profit Content -->
                <div id="profitContent" class="brain-content">
                    <div class="profit-analysis">
                        <div class="price-charts">
                            <h4>Historical Prices (3 Years)</h4>
                            <div id="priceChart" class="chart-container">
                                <!-- Price chart will be rendered here -->
                            </div>
                        </div>
                        
                        <div class="margin-projections">
                            <h4>Projected Margins</h4>
                            <div class="margin-table">
                                <!-- Margin data will be populated -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Markets Tab -->
            <div id="marketsTab" class="tab-content">
                <div class="tab-header">
                    <h2>Market Intelligence</h2>
                    <div class="market-filters">
                        <select class="region-filter">
                            <option value="all">All Regions</option>
                            <option value="north">North India</option>
                            <option value="south">South India</option>
                        </select>
                    </div>
                </div>

                <div class="markets-grid">
                    <div class="market-section">
                        <h3>Live Prices</h3>
                        <div class="price-grid">
                            <!-- Price data will be populated -->
                        </div>
                    </div>

                    <div class="market-section">
                        <h3>Market News</h3>
                        <div class="news-feed">
                            <div class="news-item">
                                <div class="news-impact positive">↑ Demand</div>
                                <div class="news-content">
                                    <h4>Wheat export demand rises on global shortage</h4>
                                    <p class="news-time">2 hours ago</p>
                                </div>
                            </div>
                            <div class="news-item">
                                <div class="news-impact negative">↓ Supply</div>
                                <div class="news-content">
                                    <h4>Cotton harvest delayed due to unseasonal rain</h4>
                                    <p class="news-time">5 hours ago</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guidance Tab -->
            <div id="guidanceTab" class="tab-content">
                <div class="tab-header">
                    <h2>7-Day Action Plan</h2>
                    <div class="guidance-controls">
                        <button class="btn-outline refresh-tasks">
                            <i class="icon-refresh"></i>
                            Update Tasks
                        </button>
                    </div>
                </div>

                <div class="tasks-timeline">
                    <div id="weeklyTasks" class="tasks-container">
                        <div class="task-item">
                            <div class="task-day">Today</div>
                            <div class="task-description">Check soil moisture levels in north field</div>
                            <div class="task-weather">Clear skies, good for field work</div>
                        </div>
                        <div class="task-item">
                            <div class="task-day">Tomorrow</div>
                            <div class="task-description">Skip irrigation - 65% rain expected</div>
                            <div class="task-weather">Heavy rain likely afternoon</div>
                        </div>
                        <div class="task-item">
                            <div class="task-day">Day 3</div>
                            <div class="task-description">Apply nitrogen fertilizer to wheat fields</div>
                            <div class="task-weather">Partly cloudy, good conditions</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feedback Tab -->
            <div id="feedbackTab" class="tab-content">
                <div class="tab-header">
                    <h2>Help Improve Recommendations</h2>
                    <p class="feedback-subtitle">Your feedback helps train our AI for better results</p>
                </div>

                <div class="feedback-section">
                    <h3>How were today's recommendations?</h3>
                    <div class="feedback-buttons">
                        <button class="feedback-btn good" data-type="good">
                            <i class="icon-thumbs-up"></i>
                            Looks right
                        </button>
                        <button class="feedback-btn neutral" data-type="soil-mismatch">
                            <i class="icon-soil"></i>
                            Not for my soil
                        </button>
                        <button class="feedback-btn neutral" data-type="water-heavy">
                            <i class="icon-water"></i>
                            Too water-heavy
                        </button>
                        <button class="feedback-btn neutral" data-type="market-risk">
                            <i class="icon-warning"></i>
                            Market risk high
                        </button>
                    </div>

                    <div class="feedback-comments">
                        <textarea placeholder="Additional comments (optional)..." rows="3"></textarea>
                        <button class="btn-primary submit-feedback">Submit Feedback</button>
                    </div>
                </div>

                <div class="improvement-stats">
                    <h3>Model Improvements</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number">1,247</div>
                            <div class="stat-label">Feedback submissions</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">+5.2%</div>
                            <div class="stat-label">Accuracy improvement</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">94%</div>
                            <div class="stat-label">Farmer satisfaction</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
